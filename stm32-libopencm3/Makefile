# Project name
BIN = stm32-libopencm3

# Include paths
OPENCM3_DIR = ./libopencm3

INC = -I$(OPENCM3_DIR)/include \
      -L$(OPENCM3_DIR)/lib

# Setup the target MCU used with libopencm3
OPENCM3_DEVICE = stm32f030r8
OPENCM3_LIB = libopencm3_stm32f0.a
DEF = -DSTM32F0

# Linker script (generated by libopencm3)
SRC_LD = $(BUILD_DIR)/$(OPENCM3_DEVICE).ld

# OpenOCD setup
OPENOCD ?= openocd -f board/st_nucleo_f0.cfg

# Setup dependencies (to build libopencm3 automatically)
DEPS = libopencm3
DEPS_CLEAN = libopencm3_clean

include ../cm-makefile/common.mk
include ../cm-makefile/openocd.mk
include ../cm-makefile/libopencm3.mk    # Builds libopencm3
include ../cm-makefile/libopencm3_ld.mk # Generates linker script

# Setup linker flags required by libopencm3
LDFLAGS += -l$(subst lib,,$(subst .a,,$(OPENCM3_LIB)))
LDFLAGS += -nostartfiles
