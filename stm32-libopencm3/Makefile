# Project name
BIN = stm32-libopencm3

# Include paths
OPENCM3_DIR = ../thirdparty/libopencm3

INC = -I$(OPENCM3_DIR)/include \
      -L$(OPENCM3_DIR)/lib

# Setup the target MCU used with libopencm3
OPENCM3_DEVICE = stm32f030r8
OPENCM3_TARGET = stm32/f0
DEF = -DSTM32F0

# Linker script (generated by libopencm3)
SRC_LD = $(BUILD_DIR)/$(OPENCM3_DEVICE).ld

# OpenOCD setup
OPENOCD ?= openocd -f board/st_nucleo_f0.cfg

include ../cm-makefile/config.mk
include ../cm-makefile/openocd.mk
include ../cm-makefile/libopencm3.mk    # Builds libopencm3
include ../cm-makefile/libopencm3_ld.mk # Generates linker script
include ../cm-makefile/rules.mk

# OpenOCD-specific target
.PHONY: erase
erase:
	$(CMD_ECHO) $(OPENOCD) -c \
	"init; \
	reset halt; \
	sleep 100; \
	stm32f1x mass_erase 0; \
	shutdown"
